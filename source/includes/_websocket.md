# WebSocket API

With the WebSocket API, you have full access to the exchange, you can also check our JavaScript WebSocket implementation [here](https://github.com/blinktrade/frontend/blob/master/jsdev/bitex/api/bitex.js#L760-L1784).

## Connectivity

```javascript

var BlinkTradeWS = require("blinktrade").BlinkTradeWS;
var BlinkTrade = new BlinkTradeWS({ prod: true });

BlinkTrade.connect().then(function() {
  // Connected
});

```

### Heartbeat

You must send this message each 30 seconds, in order to keep your connection alive.

> __EXAMPLE MESSAGE__

```json
{
    "MsgType": "1",
    "TestReqID": "123",
    "SendTime": 1469031953
}
```


```javascript

BlinkTrade.connect().then(function() {
  return BlinkTrade.heartbeat();
}).then(function(heartbeat) {
  console.log(heartbeat.Latency);
});

```

### Paratemers

Name      | Type   | Description
----------|--------|------------
MsgType   | string | [1](http://www.onixs.biz/fix-dictionary/4.4/msgType_1_1.html)
[TestReqID](http://www.onixs.biz/fix-dictionary/4.4/tagNum_112.html) | string | An ID assigned by you. It can be any number. The response message associated with this request will contain the same ID
SendTime  | number | Unix Time Stamp


> __EXAMPLE RESPONSE__

```json
{
    "MsgType": "0",
    "TestReqID": "123",
    "SendTime": 1469031953,
    "ServerTimestamp": 1469032804
}
```

### Response

Name            | Type   | Description
----------------|--------|------------
MsgType         | string | [0](http://www.onixs.biz/fix-dictionary/4.4/msgType_0_0.html)
[TestReqID](http://www.onixs.biz/fix-dictionary/4.4/tagNum_112.html) | string | This should match the TestReqID sent on the message
SendTime        | number | This should match your SendTime
ServerTimestamp | number | Server Unix Time Stamp

## Authentication

Most of WebSocket calls requires authentication, once you login with your username and password on the WebSocket connection, you will be able to access your account. You can also login with your API Key and API Password, you only be allowed to send messages that your API Key has permission to send.

### FingerPrint

Each request requires that you pass a fingerprint from your browser, there's a few finger prints implementations that you can use.

* [Our google closure implementation](https://github.com/blinktrade/frontend/blob/master/jsdev/bitex/util/util.js#L96-L157)
* [fingerprintjs2](https://github.com/Valve/fingerprintjs2)

### Login

> __EXAMPLE MESSAGE__

```json
{
    "MsgType": "BE",
    "UserReqID": 1123107,
    "BrokerID": 5,
    "Username": "TYD3ZilY0FDB1QdkD1iDdlqvcRdnV0sZILNh3D18ZKs",
    "Password": "ySIMrLdTqSDo3vL",
    "UserReqTyp": "1",
    "FingerPrint": "b959a35c7f3f5e9315c99b5a25c2bbda"
}
```

```javascript

BlinkTrade.connect().then(function() {
  return BlinkTrade.login({ username: "", password: "" });
}).then(function(logged) {
  console.log(logged);
});

```

### Parameters

Name                    | Type   | Description
------------------------|--------|------------
MsgType                 | string | [BE](http://www.onixs.biz/fix-dictionary/4.4/msgType_BE_6669.html)
UserReqID               | number | Request Id
BrokerID                | number | [\<BROKER_ID\>](#brokers)
Username                | string | The email address, username or API Key of the user
Password                | string | The password of the user
UserReqTyp              | string | "1"
FingerPrint             | string | Browser [fingerprint](#fingerprint)
SecondFactor            | number | **Optional**; Second Factor Authentication code generated by authy
UserAgent               | string | **Optional**; Browser user agent navigator
UserAgentLanguage       | string | **Optional**; User agent language
UserAgentTimezoneOffset | number | **Optional**; User agent timezone offset
UserAgentPlatform       | string | **Optional**; User agent platform

### Response

Returns a Login Model Object together with Profile and Broker information.

> __EXAMPLE RESPONSE__

```json
{
    "MsgType": "BF",
    "Broker": {
    },
    "BrokerID": 5,
    "DepositFixedFee": null,
    "DepositPercentFee": null,
    "EmailLang": "en",
    "HasLineOfCredit": false,
    "IsBroker": false,
    "IsMSB": true,
    "Profile": {
        "Verified": 3,
        "UserID": 90800127,
        "TwoFactorEnabled": false,
        "EmailLang": "en",
        "EmailTwoFactorEnabled": false,
        "Type": "USER",
        "Email": "cesardeazevedo@outlook.com",
        "Username": "cesaraugusto",
        "IsMSB": true,
        "CountryCode": "US",
        "WithdrawFixedFee": null,
        "HasLineOfCredit": false,
        "TakerTransactionFeeSell": 500,
        "ConfirmationOrder": false,
        "Country": "US",
        "TakerTransactionFeeBuy": 500,
        "IsMarketMaker": false,
        "ID": 90800127,
        "DepositPercentFee": null,
        "DepositFixedFee": null,
        "WithdrawPercentFee": null,
        "TransactionFeeBuy": 500,
        "State": "NY",
        "TransactionFeeSell": 500,
        "NeedWithdrawEmail": false
    },
    "TakerTransactionFeeBuy": 500,
    "TakerTransactionFeeSell": 500,
    "TransactionFeeBuy": 500,
    "TransactionFeeSell": 500,
    "TwoFactorEnabled": false,
    "UserID": 90800127,
    "UserStatus": 1,
    "Username": "cesaraugusto",
    "WithdrawFixedFee": null,
    "WithdrawPercentFee": null,
    "ConfirmationOrder": false,
    "UserReqID": 1123107,
    "IsMarketMaker": false,
    "EmailTwoFactorEnabled": false,
    "PermissionList": {
        "*": []
    }
}
```

Parameter               | Type   | Description
------------------------|--------|-------------
MsgType                 | string | [BF](http://www.onixs.biz/fix-dictionary/4.4/msgType_BF_6670.html)
Broker                  | object | Broker model object, see [broker response](#brokerlistgrp-model) for more informations
BrokerID                | number | [\<BROKER_ID\>](#brokers)
DepositFixedFee         | number | Fixed deposit fee
DepositPercentFee       | number | Deposit fixed fee
EmailLang               | string | Email Language
HasLineOfCredit         | boolean| `boolean` indicating whether user has line of credit
IsBroker                | boolean| `boolean` whether user is a broker
IsMSB                   | boolean|
Profile                 | object | Profile model object, see [profile model]() for more informations
TakerTransactionFeeBuy  | number | Taker fee for buy orders
TakerTransactionFeeSell | number | Taker fee for sell orders
TransactionFeeBuy       | number | Maker fee for buy orders
TransactionFeeSell      | number | Maker fee for sell orders
TwoFactorEnabled        | boolean| `boolean` indicating whether user has two factor enabled
UserID                  | number | Integer with the user ID
UserReqTyp              | number | Returns only if it is equal to 3 when password has been changed
UserStatus              | number | "1" = Logged In, "2" = Not Logged In, "3" = User Not Recognised
Username                | string | String with the username of the user
WithdrawFixedFee        | number | Fixed fee for withdraws
WithdrawPercentFee      | number |

## Balances

> __EXAMPLE MESSAGE__

```json

{
    "MsgType": "U2",
    "BalanceReqID": reqId
}

```

```javascript

BlinkTrade.connect().then(function() {
  return BlinkTrade.login({ username: "", password: "" });
}).then(function() {
  return BlinkTrade.balance()
}).then(function(balance) {
  console.log(balance);
});

```

### Parameters

| Name         | Type   | Description       |
|--------------|--------|-------------------|
| MsgType      | string | U2                |
| BalanceReqID | string | Request ID        |
| ClientID     | object | **Optional**; ClientID

### Response

> EXAMPLE RESPONSE

``` json
{
    "MsgType": "U3",
    "5": {
        "BTC_locked": 505000000,
        "USD": 560047769123,
        "BTC": 2430523267,
        "USD_locked": 2472100000
    },
    "ClientID": 90800127,
    "BalanceReqID": 5821551
}
```

Returns your balance for each [BrokerID](#brokers).

Name         | Type    | Description/Value
-------------|---------|------------------
MsgType      | string  | "U3" UserBalanceResponse message.
[\<BROKER_ID\>](#brokers)| object  | The [Broker ID](#brokers) containing your BTC and FIAT balance, e.g.: "5" stands for your balance with the [Broker ID](#brokers) number 5.
ClientID     | number  | Your account ID.
BalanceReqID | number  | This should match the BalanceReqID sent on the message "U2".

Balance model example for BTC and USD

Name         | Type   | Description
-------------|--------|------------
BTC          | number | Amount in satoshis of BTC you have available in your account.
USD          | number | Amount in USD (or your FIAT currency) you have available in your account.
BTC_locked   | number | Amount in satoshis of BTC you have locked (open orders, margin positions, etc).
USD_locked   | number | Amount in USD (or your FIAT currency) you have locked (open orders, margin positions, etc).


## Market Data

### Subscribe Market Data

You can subscribe to one or more Market Data and receive one or more Market Data Entries in realtime,
each Market Data Entry is composed by a bid, offer or a trade occured.


> __EXAMPLE MESSAGE__

```json


{
    "MsgType": "V",
    "MDReqID": 123,
    "SubscriptionRequestType": "1",
    "MarketDepth": "0",
    "MDUpdateType": "1",
    "MDEntryTypes": ["0", "1", "2"],
    "Instruments": ["BTCBRL"]
}


```

```javascript

BlinkTrade.connect().then(function() {
  return BlinkTrade.subscribeOrderbook(["BTCUSD"]);
}).then(function(orderbook) {
  console.log(orderbook);
});

```

### Parameters

| Name                    | Type   | Description                                                        |
|-------------------------|--------|--------------------------------------------------------------------|
| MsgType                 | string | "V"                                                                |
| MDReqID                 | number | Request ID                                                         |
| SubscriptionRequestType | string | "1" = Subscribe, "2" = Unsubscribe                                 |
| MarketDepth             | string | "0" = Full Book, "1" = Top of Book                                 |
| [MDEntryTypes](http://www.onixs.biz/fix-dictionary/4.4/tagNum_269.html) | array(string) | "0" = Bid, "1" = Offer, "2" = Trade |
| [MDUpdateType](http://www.onixs.biz/fix-dictionary/4.4/tagNum_265.html) | string | "0" = Full Refresh, "1" = Incremental RefreshRefresh                                            |
| Instruments             | array(string) | Array with the symbols that you want to subscribe e.g.: ['BTCBRL'] |

### Response Full Book

| Name        | Type   | Description                    |
|-------------|--------|--------------------------------|
| MsgType     | string | "W"                            |
| MDReqID     | number | Request ID                     |
| MarketDepth | string | "0" = Full Book, "1" = Top of Book |
| Symbol      | string | Instrument symbol subscribed   |
| MDFullGrp   | object | Object containing all orders   |


> __EXAMPLE RESPONSE FULL ORDER BOOK__

```json
{
    "MDReqID": 3140401,
    "Symbol": "BTCUSD",
    "MsgType": "W",
    "MDFullGrp": [{
        "MDEntryPositionNo": 1,
        "MDEntrySize": 113810,
        "MDEntryPx": 62181000000,
        "MDEntryID": 1459028463557,
        "MDEntryTime": "02:21:06",
        "MDEntryDate": "2016-07-13",
        "UserID": 90000002,
        "OrderID": 1459028463557,
        "MDEntryType": "0",
        "Broker": "exchange"
    }],
    "MarketDepth": 0
}
```

While you are subscribed to incremental updates, you will receive bids, asks and trades occured in realtime.

### Incremental Refresh Response

| Name     | Type   | Description                         |
|----------|--------|-------------------------------------|
| MsgType  | string | "X"                                 |
| MDReqID  | number | Request ID                          |
| MDBkTyp  | string | "3" = Order Depth                   |
| MDIncGrp | array  | Array containing the new data entry |

### Response MDIncGrp Entry

> __EXAMPLE RESPONSE__

```shell
{
    "MDReqID": 3140401,
    "MDBkTyp": "3",
    "MsgType": "X",
    "MDIncGrp": [{
        "OrderID": 1459028463562,
        "MDEntryPx": 61795000000,
        "MDUpdateAction": "0",
        "MDEntryTime": "18:09:09",
        "Symbol": "BTCUSD",
        "UserID": 90800127,
        "Broker": "exchange",
        "MDEntryType": "0",
        "MDEntryPositionNo": 10,
        "MDEntrySize": 1000000,
        "MDEntryID": 1459028463562,
        "MDEntryDate": "2016-07-13"
    }]
}
```

| Name              | Type   | Description                                                        |
|-------------------|--------|--------------------------------------------------------------------|
| OrderID           | number | Order ID                                                           |
| MDEntryPx         | number | Order Price                                                        |
| MDUpdateAction    | string | "0" = New, "1" = Update, "2" = Delete, "3" = Delete Thru           |
| MDEntryTime       | string | Time when order was created                                        |
| Symbol            | string | Order symbol that you have subscribed on market data e.g: "BTCUSD" |
| UserID            | number | User ID                                                            |
| Broker            | string | Broker name that order belongs to                                  |
| MDEntryType       | string | "0" = Bid, "1" = Offer, "2" = Trade                                |
| MDEntryPositionNo | number | Order position on the book                                         |
| MDEntrySize       | number | Order size amount                                                  |
| MDEntryID         | number | Market data entry ID                                               |
| MDEntryDate       | string | Date when market data was received                                 |

## Security Status

## Orders

### Order List Request

> __EXAMPLE MESSAGE__

```json
{
    "MsgType": "U4",
    "OrdersReqID": 123
}
```

```javascript

BlinkTrade.connect().then(function() {
  return BlinkTrade.login({ username: "", password: "" });
}).then(function() {
  return BlinkTrade.myOrders();
}).then(function(myOrders) {
  console.log(myOrders);
});


```

| Name         | Type   | Description                   |
|--------------|--------|-------------------------------|
| MsgType      | string | U4                            |
| BalanceReqID | string | Request ID                    |
| Page         | number | **Optional**; defaults to 0   |
| PageSize     | number | **Optional**; defaults to 20  |


> __EXAMPLE RESPONSE__

```json
{
  "MsgType": "U5",
  "OrdersReqID": 123,
  "Page": 0,
  "PageSize": 20,
  "Columns": [
    "ClOrdID",
    "OrderID",
    "CumQty",
    "OrdStatus",
    "LeavesQty",
    "CxlQty",
    "AvgPx",
    "Symbol",
    "Side",
    "OrdType",
    "OrderQty",
    "Price",
    "OrderDate",
    "Volume",
    "TimeInForce"
  ],
  "OrdListGrp": [
    [
      "7891067",
      1459028474127,
      100000000,
      "2",
      0,
      0,
      66563000000,
      "BTCUSD",
      "1",
      "2",
      100000000,
      66563000000,
      "2016-07-17 18:32:21",
      66563000000.0,
      "1"
    ]
  ]
}
```

### Order List Response

Name        | Type          | Description/Value
------------|---------------|------------------
MsgType     | string        | "U5" OrdersListResponse message.
OrdersReqID | number        | Match the request OrdersReqID field
Page        | number        | Starts at 0.
PageSize    | number        | The page size. If the length of the array `OrdListGrp` is greather or equal to the `PageSize`, you should issue a new request incrementing the `Page`.
Columns     | array(string) | Description of all columns of all orders in `OrdListGrp`.


Index Array (Name) | Type   | Description/Value
-------------------|--------|------------------
0  ("ClOrdID")     | string | Client order ID set by you.
1  ("OrderID")     | number | Order ID set by BlinkTrade.
2  ("CumQty")      | number | The executed quantity of this order.
3  ("OrdStatus")   | string | "0" = New, "1" = Partially filled, "2" = Filled, "4" = Cancelled, "8" = Rejected, "A" = Pending New
4  ("LeavesQty")   | number | Quantity open for further execution.
5  ("CxlQty")      | number | Total quantity canceled for this order.
6  ("AvgPx")       | number | Calculated average price of all fills on this order.
7  ("Symbol")      | string | [\<SYMBOL\>](#symbols)
8  ("Side")        | string | "1" = Buy, "2" = Sell, "E" = Redem, "F" = Lend, "G" = Borrow
9  ("OrdType")     | string | "2" = Limited
10 ("OrderQty")    | number | Quantity ordered in satoshis.
11 ("Price")       | number | Price per unit in "satoshis" of your local currency. Example: $ 2,125.89 = 212589000000
12 ("OrderDate")   | string | Order date in UTC.
13 ("Volume")      | number | Quantity * Price
14 ("TimeInForce") | string | "0" = Day, "1" = Good Till Cancel, "4" = Fill or Kill


### Send Order

[Floats are Evil!](http://floating-point-gui.de/basic/)

Converting Floats to Integers can be dangerous, different programming languages can get weird rounding errors and
imprecisions, so all API returns prices and bitcoin values as Integers and in "satoshis" format, we also expect Integers
as input, make sure that you're formatting the values properly to avoid precision issues.

> __EXAMPLE MESSAGE__

```json

{
    "MsgType": "D",
    "ClOrdID": 123,
    "Symbol": "BTCBRL",
    "Side": "1",
    "OrdType": "2",
    "Price": 190000000000,
    "OrderQty": 50000000,
    "BrokerID": 5,
}

```

```javascript

BlinkTrade.connect().then(function() {
  return BlinkTrade.login({ username: "", password: "" });
}).then(function() {
  BlinkTrade.sendOrder({
    "side": "1", // Buy
    "price": parseInt((550 * 1e8).toFixed(0)),
    "amount": parseInt((0.05 * 1e8).toFixed(0)),
    "symbol": "BTCUSD",
  });
}).then(function(order) {
  console.log(order);
});

```

Name     | Type   | Description/Value
---------|--------|------------------
MsgType  | string | "D"
ClOrdID  | number | Unique identifier for Order as assigned by you.
Symbol   | string | [\<SYMBOL\>](#symbols)
Side     | string | "1" = Buy, "2" = Sell
OrdType  | string | "2" = Limited
Price    | number | Price in satoshis.
OrderQty | number | Quantity in satoshis.
BrokerID | number | [\<BROKER_ID\>](#brokers)

### Cancel Order

> __MESSAGE EXAMPLE__

```json
{
    "MsgType": "F",
    "OrderID": 1459028830899,
    "ClOrdID": 123
}
```

```javascript

BlinkTrade.cancelOrder({ orderID: order.OrderID, clientId: order.ClOrdID }).then(function(order) {
  console.log("Order Cancelled");
});

```

### Parameters

Name    | Type   | Description/Value
--------|--------|------------------
MsgType | string | "F" Order Cancel Request message. Check for a full doc here: [http://www.onixs.biz/fix-dictionary/4.4/msgType_F_70.html](http://www.onixs.biz/fix-dictionary/4.4/msgType_F_70.html).
ClOrdID | number | ID for an Order as assigned by you.

> __MESSAGE RESPONSE__

```json
{
    "OrderID": 1459028830811,
    "ExecID": 740972,
    "ExecType": "0",
    "OrdStatus": "0",
    "CumQty": 0,
    "Symbol": "BTCUSD",
    "OrderQty": 5000000,
    "LastShares": 0,
    "LastPx": 0,
    "Price": 55000000000,
    "TimeInForce": "1",
    "LeavesQty": 5000000,
    "MsgType": "8",
    "ExecSide": "1",
    "OrdType": "2",
    "CxlQty": 0,
    "Side": "1",
    "ClOrdID": 3251968,
    "AvgPx": 0
}
```

## Ledger

List all your trades activity, each row on the ledger represents either a trade occurred or trade fees.

> __EXAMPLE MESSAGE__

```json
{
    "MsgType": "U34",
    "LedgerListReqID": 123
}
```

### Parameters

Name            | Type          | Description/Value
----------------|---------------|------------------
MsgType         | string        | U34
LedgerListReqID | number        | Request ID
Page            | number        | **Optional**; defaults to 0
PageSize        | number        | **Optional**; defaults to 20


> __EXAMPLE RESPONSE__

```json
{
  "MsgType": "U35",
  "Page": 0,
  "PageSize": 100,
  "LedgerListReqID": 123,
  "Columns": [
    "LedgerID",
    "Currency",
    "Operation",
    "AccountID",
    "BrokerID",
    "PayeeID",
    "PayeeBrokerID",
    "Amount",
    "Balance",
    "Reference",
    "Created",
    "Description",
    "AccountName"
  ],
  "LedgerListGrp": [
    [
      128197,
      "BTC",
      "D",
      90000002,
      5,
      90000001,
      5,
      994273,
      29128175022,
      "1459028474211.1459028474155",
      "2016-07-20 11:23:07",
      "TF",
      "user"
    ]
  ]
}
```

### Response

| Name               | Type   | Description
|--------------------|--------|------------
| 0  (LedgerID)      | number | Ledger row ID
| 1  (Currency)      | string | Currency of the trade, either crypto or fiat
| 2  (Operation)     | string | MsgType of the trade occurred e.g.: "D"
| 3  (AccountID)     | number | Your account id
| 4  (BrokerID)      | number | BrokerID
| 5  (PayeeID)       | number | Payee's account id
| 6  (PayeeBrokerID) | number | Payee's BrokerID
| 7  (Amount)        | number | Amount of the trade depending of the currency occurred
| 8  (Balance)       | number | Balance after trade occurred
| 9  (Reference)     | string | Reference data
| 10 (Created)       | string | Creating date
| 11 (Description)   | string | "TF" = Trade Fees, "T" = Trade
| 12 (AccountName)   | string | Your profile usernam


## Deposit

### Deposit List

> __EXAMPLE MESSAGE__

```json
{
    "MsgType": "U30",
    "DepositListReqID": 123,
    "StatusList": ["1"]
}
```

```javascript

blinktrade.requestDepositList().then(function(deposit) {
  console.log(deposit);
});

```

### Parameters

Name             | Type          | Description/Value
-----------------|---------------|------------------
MsgType          | string        | U30
DepositListReqID | number        | Request ID
Page             | number        | **Optional**; defaults to 0
PageSize         | number        | **Optional**; defaults to 20
StatusList       | array(string) | Array of strings where: "1" is Pending, "2" is In Progress, "4" is Completed, "8" is Cancelled. **Optional**; defaults to ["1"]
Filter           | array(string) | **Optional** filters
ClientID         | number        | **Optional** Client ID

### Response

> __EXAMPLE RESPONSE__

```json
{
  "PageSize": 20,
  "DepositListReqID": 123,
  "MsgType": "U31",
  "DepositListGrp": [
  ],
  "Page": 0,
  "Columns": [
    "DepositID",
    "DepositMethodID",
    "DepositMethodName",
    "Type",
    "Currency",
    "Value",
    "PaidValue",
    "Data",
    "Created",
    "ControlNumber",
    "PercentFee",
    "FixedFee",
    "Status",
    "ReasonID",
    "Reason",
    "Username",
    "UserID",
    "BrokerID",
    "ClOrdID",
    "CreditProvided",
    "State"
  ]
}
```

## Withdraws

### Requesting a withdraw


### Paramenters

Params        | Type   | Description/Value
--------------|--------|------------------
MsgType       | string | "U6"
WithdrawReqID | number | Request ID
Method        | string | bitcoin for BTC. Check with the exchange all available withdrawal methods
Amount        | number | Amount in satoshis
Currency      | string | Currency code
Data          | object | Data object containing your wallet address e.g.: {"Data": { "Wallet": "mwmabpJVisvti3WEP5vhFRtn3yqHRD9KNP" }}



### Withdraw methods

There are different methods of withdraws for each currency, they are created dynamically by each broker, you can take a look logging as a broker on
[testnet.blinktrade.com](https://testnet.blinktrade.com), and go to `admin` tab and `Withdraw methods`
